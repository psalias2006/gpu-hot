<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPU Hot - Interactive Demo</title>

    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Application Styles (modular, from CDN) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/psalias2006/gpu-hot@main/static/css/tokens.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/psalias2006/gpu-hot@main/static/css/layout.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/psalias2006/gpu-hot@main/static/css/components.css">

    <style>
    /* Demo-specific notice */
    .demo-notice {
        position: fixed;
        top: 12px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(255, 193, 7, 0.12);
        border: 1px solid rgba(255, 193, 7, 0.25);
        border-radius: 6px;
        padding: 6px 16px;
        color: rgba(255, 193, 7, 0.85);
        font-size: 11px;
        font-weight: 600;
        letter-spacing: 0.5px;
        z-index: 1000;
        pointer-events: none;
    }
    </style>
</head>
<body>
    <div class="demo-notice">INTERACTIVE DEMO â€” SIMULATED DATA</div>

    <div class="studio">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-logo">GPU</div>

            <nav class="sidebar-nav" id="view-selector">
                <button class="sidebar-btn active" data-view="overview" onclick="switchToView('overview')" title="All GPUs">All</button>
            </nav>

            <div class="sidebar-bottom">
                <div class="system-info">
                    <div class="system-metric">
                        <canvas class="system-metric-chart" id="cpu-chart"></canvas>
                        <div class="system-metric-value" id="cpu-usage">0%</div>
                        <div class="system-metric-label">CPU</div>
                    </div>
                    <div class="system-metric">
                        <canvas class="system-metric-chart" id="memory-chart"></canvas>
                        <div class="system-metric-value" id="memory-usage">0%</div>
                        <div class="system-metric-label">RAM</div>
                    </div>
                </div>

                <a href="https://github.com/psalias2006/gpu-hot" target="_blank" rel="noopener noreferrer" class="sidebar-link" title="GitHub">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                    </svg>
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main">
            <div class="header">
                <div class="header-row">
                    <div class="header-status">
                        <div class="status-dot connected" id="status-dot"></div>
                        <span id="connection-status">Demo Mode</span>
                    </div>
                    <div class="version-info" id="version-info">
                        <span id="version-current">demo</span>
                    </div>
                </div>
            </div>

            <!-- Overview Tab -->
            <div id="tab-overview" class="tab-content active">
                <div id="overview-container" class="overview-grid">
                </div>
            </div>

            <!-- Individual GPU Tabs (dynamically created) -->

            <!-- Processes -->
            <div class="processes-section">
                <div class="processes-header" onclick="toggleProcesses()">
                    <div class="processes-title">Processes</div>
                    <div class="processes-toggle">
                        <span id="process-count">0</span>
                        <span class="toggle-icon">&#9660;</span>
                    </div>
                </div>
                <div class="processes-content" id="processes-content">
                    <div class="processes-inner" id="processes-container">
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Chart detail drawer -->
    <div class="drawer-overlay" id="drawer-overlay"></div>
    <div class="drawer" id="chart-drawer">
        <div class="drawer-header">
            <div class="drawer-header-left">
                <span class="drawer-title" id="drawer-title">Chart</span>
                <div class="drawer-hero" id="drawer-hero">
                    <span class="drawer-hero-value" id="drawer-hero-value">--</span>
                    <span class="drawer-hero-unit" id="drawer-hero-unit"></span>
                </div>
            </div>
            <button class="drawer-close" id="drawer-close" aria-label="Close">&times;</button>
        </div>
        <div class="drawer-body">
            <div class="drawer-chart-wrap">
                <canvas id="drawer-chart-canvas"></canvas>
            </div>
            <div class="drawer-companions" id="drawer-companions"></div>
            <div class="drawer-stats-bar" id="drawer-stats"></div>
        </div>
    </div>

    <!-- Application Scripts (from CDN) -->
    <script src="https://cdn.jsdelivr.net/gh/psalias2006/gpu-hot@main/static/js/chart-config.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/psalias2006/gpu-hot@main/static/js/chart-manager.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/psalias2006/gpu-hot@main/static/js/gpu-cards.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/psalias2006/gpu-hot@main/static/js/ui.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/psalias2006/gpu-hot@main/static/js/chart-drawer.js"></script>

    <!-- Demo Data Generator (replaces socket-handlers.js + app.js) -->
    <script>
    // ============================================================================
    // DEMO DATA GENERATOR - Simulates realistic GPU data
    // ============================================================================

    const GPU_NAMES = [
        'NVIDIA GeForce RTX 4060 Ti',
        'NVIDIA GeForce RTX 4080',
    ];

    const PROCESS_NAMES = [
        'python3',
        'pytorch_train.py',
        'tensorflow',
        'chrome',
        'code',
    ];

    class DemoDataGenerator {
        constructor(numGPUs = 1) {
            this.numGPUs = numGPUs;
            this.gpuStates = [];
            this.time = 0;

            for (let i = 0; i < numGPUs; i++) {
                this.gpuStates.push({
                    baseUtil: 0 + Math.random() * 5,
                    baseTemp: 30 + Math.random() * 5,
                    basePower: 10 + Math.random() * 10,
                    baseMemUsed: 500 + Math.random() * 100,
                    memTotal: 16384,
                    totalEnergy: 0
                });
            }
        }

        generateGPUData() {
            this.time += 1;
            const gpus = {};

            for (let i = 0; i < this.numGPUs; i++) {
                const state = this.gpuStates[i];

                const noise = () => (Math.random() - 0.5) * 3;
                const wave = Math.sin(this.time * 0.03 + i) * 8;

                const utilization = Math.max(0, Math.min(100, state.baseUtil + wave + noise()));
                const temperature = Math.max(25, Math.min(85, 31 + utilization * 0.2 + noise() * 0.3));

                const idlePower = 11.5;
                const powerDraw = utilization > 3 ?
                    Math.max(idlePower, Math.min(165, idlePower + (utilization / 100) * 150 + wave + noise() * 2)) :
                    idlePower;

                const memoryUsed = Math.max(512, Math.min(state.memTotal, state.baseMemUsed + wave * 20 + noise() * 50));

                const idleGraphicsClock = 210;
                const maxGraphicsClock = 2610;
                const idleMemoryClock = 405;
                const maxMemoryClock = 10501;

                const clockGraphics = utilization > 3 ?
                    Math.round(idleGraphicsClock + (utilization / 100) * (maxGraphicsClock - idleGraphicsClock)) :
                    idleGraphicsClock;
                const clockMemory = utilization > 3 ?
                    Math.round(idleMemoryClock + (utilization / 100) * (maxMemoryClock - idleMemoryClock)) :
                    idleMemoryClock;
                const clockSm = Math.round(clockGraphics * 1.0);
                const clockSmMax = 3105;
                const clockVideo = Math.round(clockGraphics * 0.95);

                const pcieGen = utilization > 10 ? 4 : utilization > 5 ? 2 : 1;
                const pcieWidth = utilization > 10 ? 16 : 8;

                if (!state.totalEnergy) state.totalEnergy = 0;
                state.totalEnergy += (powerDraw * (0.5 / 3600));

                const bar1Used = Math.round(memoryUsed * 0.0004);
                const bar1Total = Math.round(state.memTotal * 0.016);
                const computeProcesses = utilization > 20 ? Math.floor(utilization / 30) : 0;
                const graphicsProcesses = utilization > 10 ? Math.floor(Math.random() * 2) : utilization > 5 ? 2 : 0;

                gpus[i] = {
                    name: GPU_NAMES[i % GPU_NAMES.length],
                    utilization: Math.round(utilization),
                    temperature: Math.round(temperature),
                    memory_used: Math.round(memoryUsed),
                    memory_total: state.memTotal,
                    power_draw: powerDraw,
                    power_limit: 165,
                    fan_speed: temperature < 40 ? 0 : Math.round(Math.max(0, Math.min(100, (temperature - 35) * 2))),
                    clock_graphics: clockGraphics,
                    clock_memory: clockMemory,
                    clock_sm: clockSm,
                    clock_sm_max: clockSmMax,
                    clock_video: clockVideo,
                    memory_utilization: Math.round(utilization * 0.7),
                    pcie_gen: pcieGen,
                    pcie_width: pcieWidth,
                    pcie_link_gen_max: 4,
                    pcie_link_width_max: 8,
                    pcie_tx_throughput: Math.round((utilization / 100) * 50 + Math.random() * 5),
                    pcie_rx_throughput: Math.round((utilization / 100) * 30 + Math.random() * 3),
                    performance_state: utilization > 70 ? 'P0' : utilization > 40 ? 'P2' : utilization > 3 ? 'P5' : 'P8',
                    throttle_reasons: utilization > 90 ? 'Active' : 'None',
                    driver_version: '550.163.01',
                    energy_consumption_wh: state.totalEnergy,
                    brand: 'GRID',
                    architecture: 'Ada Lovelace',
                    memory_free: state.memTotal - Math.round(memoryUsed),
                    bar1_memory_used: bar1Used,
                    bar1_memory_total: bar1Total,
                    compute_processes_count: computeProcesses,
                    graphics_processes_count: graphicsProcesses,
                    pcie_gen_max: 4,
                    pcie_width_max: 8,
                    _fallback_mode: false
                };
            }

            return gpus;
        }

        generateProcesses() {
            const numProcesses = Math.floor(Math.random() * 3);
            const processes = [];

            for (let i = 0; i < numProcesses; i++) {
                processes.push({
                    pid: 1000 + Math.floor(Math.random() * 30000),
                    name: PROCESS_NAMES[Math.floor(Math.random() * PROCESS_NAMES.length)],
                    memory: Math.round(500 + Math.random() * 3000)
                });
            }

            return processes;
        }

        generateSystemInfo() {
            const cpuBase = 10 + Math.random() * 20;
            const cpuNoise = (Math.random() - 0.5) * 10;
            const memBase = 30 + Math.random() * 20;

            return {
                cpu_percent: Math.max(5, Math.min(95, cpuBase + cpuNoise)),
                memory_percent: Math.max(20, Math.min(85, memBase + (Math.random() - 0.5) * 5))
            };
        }

        generateFullData() {
            return {
                gpus: this.generateGPUData(),
                processes: this.generateProcesses(),
                system: this.generateSystemInfo()
            };
        }
    }

    // ============================================================================
    // DEMO APPLICATION
    // ============================================================================

    const dataGenerator = new DemoDataGenerator(1);

    function handleGPUDataUpdate(data) {
        const overviewContainer = document.getElementById('overview-container');

        if (!data.gpus || Object.keys(data.gpus).length === 0) {
            overviewContainer.innerHTML = '<div class="loading">No GPU data available</div>';
            return;
        }

        Object.keys(data.gpus).forEach(gpuId => {
            const gpuInfo = data.gpus[gpuId];

            if (!chartData[gpuId]) {
                initGPUData(gpuId);
            }

            const existingOverview = overviewContainer.querySelector(`[data-gpu-id="${gpuId}"]`);
            if (!existingOverview) {
                overviewContainer.insertAdjacentHTML('beforeend', createEnhancedOverviewCard(gpuId, gpuInfo));
                initOverviewMiniChart(gpuId, gpuInfo.utilization);
            } else {
                updateOverviewCard(gpuId, gpuInfo, true);
            }

            ensureGPUTab(gpuId, gpuInfo, true);

            // Update per-GPU system charts
            if (data.system) {
                updateGPUSystemCharts(gpuId, data.system, '_demo', true);
            }
        });

        if (data.processes) {
            updateProcesses(data.processes);
        }

        if (data.system) {
            updateSystemInfo(data.system);
        }

        const gpuCount = Object.keys(data.gpus).length;
        const gpuIds = Object.keys(data.gpus);
        autoSwitchSingleGPU(gpuCount, gpuIds);
    }

    function updateDemo() {
        const data = dataGenerator.generateFullData();
        handleGPUDataUpdate(data);
    }

    document.addEventListener('DOMContentLoaded', function() {
        console.log('GPU Hot Demo initialized');
        updateDemo();
        setInterval(updateDemo, 500);
    });
    </script>
</body>
</html>
